---
title: "Reference & Exercise"
author:
  - name : "A. Abdallah , D. Mukherjee, U. Goebel"
    institute: "CECAD Bioinformatics Facility"
date: "`r format(Sys.time(), '%d, %B, %Y at %H:%M')`"
output:
   rmdformats::readthedown:
    toc_depth: 3
    df_print: paged
    highlight: tango
#    code_folding: hide
#    css: styles.css
---

```{=html}
<style>
#content{
  max-width:100%;
}

#main .nav-pills > li.active > a,
#main .nav-pills > li.active > a:hover,
#main .nav-pills > li.active > a:focus {
    background-color: #0051BA;
}

#main .nav-pills > li > a:hover {
    background-color: #0051BA;
}

#nav-top span.glyphicon {
    color: #0051BA;
}

h1, h2, h3, h4, h5, h6, legend {
    color: #0096FF;
}

#postamble {
    background-color: #4169E1;
}

#sidebar h2 {
    background-color: #0051BA;
}

div#sidebar::after {
   #content: url(https://www.cecad.uni-koeln.de/typo3conf/ext/fksitepackage/Resources/Public/Images/CECAD-Logo-24-white.svg);
    content: 'Bioinformarics Core';
    background-image: url('https://www.cecad.uni-koeln.de/typo3conf/ext/fksitepackage/Resources/Public/Images/CECAD-Logo-24-white.svg');
    background-repeat: no-repeat;
    padding: 17px 0px 17px 0px;
    display: flex; 
    justify-content: flex-end;
    color: #FFFFFF;
    background-color: #0051BA;
}

#sidebar {
    background: #E5E4E2;
}

#toc {
    background: #E5E4E2;
}

#toc li.current a{
    color: #0096FF;
}

#toc ul.nav li a {
    color: #0096FF !important;
}
<!-- h1.title { -->
<!--     background-image: url('https://www.cecad.uni-koeln.de/typo3conf/ext/fksitepackage/Resources/Public/Images/CECAD-Logo-24-white.svg'); -->
<!--     background-repeat: no-repeat; -->
<!--     background-position:right; -->
<!--     //border: 1px red dotted; -->
<!--     padding: 20px 0px 20px 0px; -->
<!--     color: #FFFFFF; -->
<!--     background-color: #0051BA; -->
<!-- } -->
.showopt {
  background-color: #004c93;
  color: #FFFFFF; 
  width: 100px;
  height: 20px;
  text-align: center;
  vertical-align: middle !important;
  float: right;
  font-family: sans-serif;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
</style>
```


```{=html}
<script>
$(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show Source</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show Output</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show Plot</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});
</script>

<script>
// Function to toggle solution display and button text
function toggleSolution(solutionId, buttonId) {
  var solutionDiv = document.getElementById(solutionId);
  var button = document.getElementById(buttonId);

  if (solutionDiv.style.display === "none") {
    if (confirm("Have you finished the task?")) {
      solutionDiv.style.display = "block";
      button.innerHTML = "Hide the solution";
    }
  } else {
    solutionDiv.style.display = "none";
    button.innerHTML = "Click here for the solution";
  }
}
</script>
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.out = "50%", fig.height = 8)
```

# Day 1 Practice

## Session 1 & 2

### Exercise 1: Simple Calculations

-   Use R to calculate the following:
    -   multiply 31 and 78
    -   divide 697 with 41
-   Assign the value of 39 to x
-   Assign the value of 22 to y

<button id="toggleBtn1" onclick="toggleSolution('solution1', 'toggleBtn1')">Click here for the solution</button>


<div id="solution1" style="display:none; margin-top: 10px;">
```{r Sol1}
31 * 78

697 / 41

x <- 39
x

y <- 22
y
```
</div>

### Exercise 2: Working with Vectors

-   Create a vector called `newvec` with 20 elements
-   add names to the elements
-   retrieve 1st 5 elements
-   retrieve any 3 elements by name

<button id="toggleBtn2" onclick="toggleSolution('solution2', 'toggleBtn2')">Click here for the solution</button>


<div id="solution2" style="display:none; margin-top: 10px;">
```{r Sol2}

myvec <- c(1:20)

names(myvec) <- LETTERS[1:20]

myvec

myvec[1:5]

myvec[c(1,4,6)]
```
</div>

### Exercise 3: Lists and Data Frames

-   Write a R program to create a list of dataframes and access each of those data frames from the list.
-   Create a data frame from a matrix of your choice, change the row names so every row says id_i (where i is the row number) and change the column names to variable_i (where i is the column number). I.e., for column 1 it will say variable_1, and for row 2 will say id_2 and so on.

<button id="toggleBtn3" onclick="toggleSolution('solution3', 'toggleBtn3')">Click here for the solution</button>


<div id="solution3" style="display:none; margin-top: 10px;">
```{r Sol3}
mylist <- list(data.frame("one"=1:10,"two"=11:20,"three"=21:30),
               data.frame("A"=letters[1:5],"B"=letters[6:10],"C"=letters[11:15] )
)

mylist

mylist[[1]]

mylist[[2]]


mymatrix <- matrix(1:100,nrow = 20, ncol = 5)
mydf <- data.frame(mymatrix)
colnames(mydf) <- paste0("variable_",1:ncol(mydf))
rownames(mydf) <- paste0("id_",rownames(mydf))
mydf
```
</div>
### Exercise 4: Reading & Writing

-   load `iris` data. save the dataframe in .csv, .tsv and .xls format

<button id="toggleBtn4" onclick="toggleSolution('solution4', 'toggleBtn4')">Click here for the solution</button>


<div id="solution4" style="display:none; margin-top: 10px;">
```{r Sol4}
data(iris)

write.csv(iris, file = "irisdata.csv")

write.table(iris, file = "irisdata.tsv", sep = "\t", quote = FALSE, row.names = FALSE)

library(openxlsx)
write.xlsx(iris, file = "irisdata.xlsx", colNames = TRUE, borders = "columns")
```

</div>



## Session 3

### Exercise 5 [simple]
Draw a scatterplot of Petal.Length versus Sepal.Length.

Then mark the mean Petal.Length of each species by a dashed vertical line. Give each line its own color.

Hints:

-   The means are pre-computed in the "How To Draw a Bar Chart" example. You can extract the Petal.Length means from the respective column of `df`.
-   Use `?par` to see the Graphical Parameters help page. 
Parameter `lty` sets the line type 

<button id="toggleBtn5" onclick="toggleSolution('solution5', 'toggleBtn5')">Click here for the solution</button>


<div id="solution5" style="display:none; margin-top: 10px;">
```{r Solution_Excercise_1}
## The code of the example:
df <- aggregate(
        iris[,1:4], 
        by = list(iris$Species), 
        FUN = mean)

# Get the means from the example df:
m <- df$Petal.Length

# Draw the scatterplot:
plot(iris$Petal.Length, 
     iris$Sepal.Length, 
     pch=19, col=2)

# Draw the lines:
abline(v=m, 
       col=c("red","green","blue"), 
       lty=2)

```

</div>

### Exercise 6 [medium]
Draw a scatterplot of Petal.Length versus Sepal.Length. Color the points by species.

Then mark the point (x=mean(Petal.Length), y=mean(Sepal.Length)) of each species with fat points on the plot. Color each point color according to its species.    
Put the names of the species as text labels next to the points.
Add a title to the plot. 

Hints:

-   The means are pre-computed in the "How To Draw a Bar Chart" example. You can extract the Petal.Length means from the respective column of `df`.
-   The `col` parameter of `plot()` can take a vector argument, assigning an individual color to each point. To construct this vector from the Species column
    + first define a mapping from species to colors (a vector, where each element is a color and each element name is a species)
    + then index this vector with the Species column
    
-   Use `?par` to see the Graphical Parameters help page.
Parameter `cex` changes the point size. Use ?base::plot to see the help page of the plot function. Parameter "main" sets the title.

<button id="toggleBtn6" onclick="toggleSolution('solution6', 'toggleBtn6')">Click here for the solution</button>


<div id="solution6" style="display:none; margin-top: 10px;">
```{r Solution_Excercise_2}
## The code of the example:
df <- aggregate(
        iris[,1:4], 
        by = list(iris$Species), 
        FUN = mean)

# Get the means from the example df:
mPL <- df$Petal.Length
mSL <- df$Sepal.Length

# print them:
mPL
mSL

# Define the colors:
species_cols <- c("red","green","blue")
# associate species names with colors:
names(species_cols) <- df$Group.1
# print the result
species_cols

# make the per-species color vector:
my_cols <- species_cols[iris$Species]
# print it
my_cols

# Draw the scatterplot, using ny_cols as color argument
plot(iris$Petal.Length, 
     iris$Sepal.Length, 
     pch=19, 
     col=my_cols)


# plot the points marking the means:
points(mPL,
       mSL,
       pch=19,
       col=species_cols,
       cex=3
       )

```

</div>

### Exercise 7 [complex]
Similar to the "Organs Distributions" example, combine three histograms in one plot, one for each of the 3 species in the iris dataset. 
Color the 3 histograms differently. 
Add a title and a legend to the plot. 
Can you position the legend towards the top middle, such that it does not overlap the histograms?

The complexity of this is in part not a question of plotting, but of programmatically producing the input to the plot!

Hints:

-   I suggest to use `tapply()` to slice the iris dataset into a named list of per-species datasets. See `?tapply`. If `x` is an index column in a data.frame `df` (like `Species` in our case), then `l <- tapply(df, ~x, data.frame`) returns a list named `l`, with as many elements as there are different `x` values. Each list element holds a subset of `df` with a fixed `x` value. In the `tapply` call, the third parameter is a function, to be a applied to the subset defined by the current index value. Here, the `data.frame()` function insists that the subset is to be returned as a data.frame rather than a list.

Can you transfer this to the present case?

-   Once you have the list, the scheme for plotting the histograms is as follows
    + Plot the histogram of ``l[[1]]`. This initializes the plot, which means that you have to set global parameters like the title, the x axis label, and the x range (`xlim`). Keep in mind that the histograms of all species must fit on the canvas!
    + Loop over the list elements 2 and 3 and plot their histograms.
    
-  For the legend, see the "How To Draw a Histogram" example. However if you just copy the example, then the legend will partly cover the histograms. Use `?legend` and check the meaning of the `x` and `y` arguments. Try to find an optimal position!

<button id="toggleBtn7" onclick="toggleSolution('solution7', 'toggleBtn7')">Click here for the solution</button>


<div id="solution7" style="display:none; margin-top: 10px;">
```{r Solution_Excercise_3_with_Extended_Hints}
# split the iris data.frame by species (the result is a named list):
iris_by_species <- 
  tapply(iris, 
         ~Species, 
         data.frame)

# The histogram of the first species initiates the plot:
# global parameters must be set here
hist(iris_by_species[[1]]$Petal.Length,
     col = 1,

     ## mind that the final plot will cover the
     ## entire species range!
     xlim=range(iris$Petal.Length), 
     xlab="Petal.Length",
     main = "Petal.Length by Species"
)
# plot the remaining species histograms in a loop:
for(i in 2:length(iris_by_species)) 
    hist(iris_by_species[[i]]$Petal.Length,
         col = i,
	 add=TRUE
    )	
# plot the legend at an optimal position:
legend("topright", 
       legend=levels(iris$Species), 
       #fill=c(rgb(1, 0, 0, alpha=0.5), 
       #       rgb(0, 0, 1, alpha=0.5))
       fill=1:3,
       x=2,
       y=13
       )
```
</div>


```{r}
library(ggplot2)
```

### Exercise 8: Simple Scatter Plot

- **Objective**: Create a scatter plot of `Sepal.Length` vs. `Sepal.Width` from the `iris` dataset.
- **Difficulty**: Easy
- **Estimated Time**: 5-10 minutes (for beginners)

```{r}
# Load the iris dataset
data(iris)

# Create a scatter plot with ggplot
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) + 
  geom_point()
```

- **Your Task**: Color the points by `Species` and add labels to the x and y axes.
- **Difficulty**: Easy
- **Estimated Time**: 5-10 minutes

<button id="toggleBtn8" onclick="toggleSolution('solution8', 'toggleBtn8')">Click here for the solution</button>

<div id="solution8" style="display:none; margin-top: 10px;">
```{r}
# Solution to Exercise 1
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +
  geom_point() +
  xlab("Sepal Length") +
  ylab("Sepal Width")
```
</div>

---

### Exercise 9: Adding Titles and Labels

- **Objective**: Use the plot from Exercise 1 and add a title, x-axis label, and y-axis label.
- **Difficulty**: Easyy
- **Estimated Time**: 5 minutes

```{r}
# Create scatter plot with labels
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +
  geom_point() +
  ggtitle("Scatter plot of Sepal Dimensions") +
  xlab("Sepal Length (cm)") +
  ylab("Sepal Width (cm)")
```

- **Your Task**: Modify the plot to include a subtitle and caption.
- **Difficulty**: Easy
- **Estimated Time**: 5 minutes

<button id="toggleBtn9" onclick="toggleSolution('solution9', 'toggleBtn9')">Click here for the solution</button>

<div id="solution9" style="display:none; margin-top: 10px;">
```{r}
# Solution to Exercise 2
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +
  geom_point() +
  ggtitle("Scatter plot of Sepal Dimensions") +
  xlab("Sepal Length (cm)") +
  ylab("Sepal Width (cm)") +
  labs(subtitle = "Iris dataset", caption = "Source: Fisher, 1936")
```
</div>

---

### Exercise 10: Bar Plot of Species Count

- **Objective**: Create a bar plot showing the count of each species in the `iris` dataset.
- **Difficulty**: Easy
- **Estimated Time**: 5-10 minutes

```{r}
# Create a bar plot of species count
ggplot(iris, aes(x = Species)) +
  geom_bar()
```

- **Your Task**: Modify the plot to use different colors for each species.
- **Difficulty**: Easy
- **Estimated Time**: 5-10 minutes

<button id="toggleBtn10" onclick="toggleSolution('solution10', 'toggleBtn10')">Click here for the solution</button>

<div id="solution10" style="display:none; margin-top: 10px;">
```{r}
# Solution to Exercise 3
ggplot(iris, aes(x = Species, fill = Species)) +
  geom_bar() +
  labs(title = "Bar Plot of Species Count")
```
</div>

---

### Exercise 11: Boxplot of Petal Length by Species

- **Objective**: Create a boxplot of `Petal.Length` for each species in the `iris` dataset.
- **Difficulty**: Medium
- **Estimated Time**: 5-10 minutes

```{r}
# Create a boxplot of Petal Length by Species
ggplot(iris, aes(x = Species, y = Petal.Length)) +
  geom_boxplot()
```

- **Your Task**: Customize the plot by changing the colors of the boxplots and adding a theme.
- **Difficulty**: Medium
- **Estimated Time**: 10-15 minutes

<button id="toggleBtn11" onclick="toggleSolution('solution11', 'toggleBtn11')">Click here for the solution</button>

<div id="solution11" style="display:none; margin-top: 10px;">
```{r}
# Solution to Exercise 4
ggplot(iris, aes(x = Species, y = Petal.Length, fill = Species)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Boxplot of Petal Length by Species")
```
</div>

---

### Exercise 12: Histogram of Sepal Length

- **Objective**: Create a histogram of `Sepal.Length` in the `iris` dataset.
- **Difficulty**: Easy
- **Estimated Time**: 5-10 minutes

```{r}
# Create a histogram of Sepal Length
ggplot(iris, aes(x = Sepal.Length)) +
  geom_histogram(binwidth = 0.3, fill = "lightblue", color = "black")
```

- **Your Task**: Change the number of bins and add a title to the histogram.
- **Difficulty**: Easy
- **Estimated Time**: 5-10 minutes

<button id="toggleBtn12" onclick="toggleSolution('solution12', 'toggleBtn12')">Click here for the solution</button>

<div id="solution12" style="display:none; margin-top: 10px;">
```{r}
# Solution to Exercise 5
ggplot(iris, aes(x = Sepal.Length)) +
  geom_histogram(binwidth = 0.2, fill = "lightgreen", color = "black") +
  labs(title = "Histogram of Sepal Length")
```
</div>

---

### Exercise 13: Faceting by Species

- **Objective**: Use faceting to create multiple scatter plots for each species in the `iris` dataset.
- **Difficulty**: Medium
- **Estimated Time**: 10 minutes

```{r}
# Facet scatter plot by Species
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) +
  geom_point() +
  facet_wrap(~ Species)
```

- **Your Task**: Customize the facet labels and add a theme to the plot.
- **Difficulty**: Medium
- **Estimated Time**: 15 minutes

<button id="toggleBtn13" onclick="toggleSolution('solution13', 'toggleBtn13')">Click here for the solution</button>


<div id="solution13" style="display:none; margin-top: 10px;">
```{r}
# Solution to Exercise 6
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) +
  geom_point() +
  facet_wrap(~ Species, 
             labeller = labeller(Species = toupper),             # 1. Uppercase labels
             nrow = 1) +                                         # 2. Set facets in a single row
  theme_minimal() +                                              # 3. Minimal theme
  theme(strip.text = element_text(face = "bold", size = 14),      # 4. Bold and larger facet labels
        strip.background = element_rect(fill = "lightblue")) +    # 5. Change background color of facet labels
  labs(title = "Faceted Scatter Plot with Custom Labels")
```
</div>

